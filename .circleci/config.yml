version: 2
jobs:
    build:
        docker:
            - image: circleci/python:3.5.3
        steps:
            - checkout
            - run: sudo pip install tox cookiecutter wheelhouse
            - run:
                name: version checks
                command: |
                    pip --version
                    virtualenv --version
                    tox --version
                    cookiecutter --version
            - run:
                name: run cookiecutter
                command: ./cookie-run-ci

            - run:
                name: build & install app requirements
                working_directory: /tmp/keg-app-ci-src
                command: |
                    wheelhouse build
                    python3 -m venv keg-app-ci
                    . keg-app-ci/bin/activate
                    wheelhouse install -- -r requirements/dev-env.txt

            - run:
                name: run the tests
                working_directory: /tmp/keg-app-ci-src
                command: |
                    . keg-app-ci/bin/activate
                    tox
